{"remainingRequest":"/Users/xmg/Desktop/前端知识/13期/Day 04/mall/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xmg/Desktop/前端知识/13期/Day 04/mall/src/views/detail/Detail.vue?vue&type=style&index=0&id=117d0e76&scoped=true&lang=css&","dependencies":[{"path":"/Users/xmg/Desktop/前端知识/13期/Day 04/mall/src/views/detail/Detail.vue","mtime":1543658523000},{"path":"/Users/xmg/Desktop/前端知识/13期/Day 04/mall/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/xmg/Desktop/前端知识/13期/Day 04/mall/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/xmg/Desktop/前端知识/13期/Day 04/mall/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/xmg/Desktop/前端知识/13期/Day 04/mall/node_modules/cache-loader/dist/cjs.js","mtime":1541055698000},{"path":"/Users/xmg/Desktop/前端知识/13期/Day 04/mall/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#detail {\n  height: 100vh;\n  position: relative;\n  z-index: 1;\n  background-color: #fff;\n}\n\n.content {\n  position: absolute;\n  top: 44px;\n  bottom: 58px;\n  left: 0;\n  right: 0;\n}\n",{"version":3,"sources":["Detail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4LA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Detail.vue","sourceRoot":"src/views/detail","sourcesContent":["<template>\r\n  <div id=\"detail\">\r\n    <detail-nav-bar @titleClick=\"selectIndex\" :current-index=\"currentIndex\"/>\r\n    <scroll class=\"content\"\r\n            ref=\"scroll\"\r\n            @scroll=\"contentScroll\"\r\n            :probe-type=\"3\"\r\n            :data=\"[topImages, goods, shop, detailInfo, paramInfo, goodsList]\">\r\n      <detail-swiper :images=\"topImages\"/>\r\n      <detail-base-info :goods=\"goods\"/>\r\n      <detail-shop-info :shop=\"shop\"/>\r\n      <detail-goods-info :detail-info=\"detailInfo\" @imageLoad=\"imageLoad\"/>\r\n      <detail-param-info ref=\"param\" :param-info=\"paramInfo\"/>\r\n      <detail-comment-info ref=\"comment\" :comment-info=\"commentInfo\"/>\r\n      <goods-list ref=\"recommend\" :goods=\"goodsList\"/>\r\n    </scroll>\r\n    <back-top v-show=\"showBackTop\" @click.native=\"backTop\"/>\r\n    <!--<cart-button @click.native=\"cartClick\"/>-->\r\n    <detail-bottom-bar @addToCart=\"addToCart\"/>\r\n    <toast ref=\"toast\"/>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import DetailNavBar from './childComps/DetailNavBar'\r\n  import DetailSwiper from './childComps/DetailSwiper'\r\n  import DetailBaseInfo from './childComps/DetailBaseInfo'\r\n  import DetailShopInfo from './childComps/DetailShopInfo'\r\n  import DetailGoodsInfo from './childComps/DetailGoodsInfo'\r\n  import DetailParamInfo from './childComps/DetailParamInfo'\r\n  import DetailCommentInfo from './childComps/DetailCommentInfo'\r\n  import DetailBottomBar from './childComps/DetailBottomBar'\r\n  import CartButton from './childComps/CartButton'\r\n\r\n  import GoodsList from 'components/content/goods/GoodsList'\r\n\r\n  import Scroll from 'components/common/scroll/Scroll'\r\n\r\n  import {getDetail, getRecommend, Goods, Shop, GoodsParam} from \"network/detail\";\r\n  import {backTopMixin} from \"common/mixin\";\r\n  import {mapActions} from 'vuex'\r\n\r\n  import Toast from 'components/common/toast/Toast'\r\n\r\n  export default {\r\n    name: \"Detail\",\r\n    components: {\r\n\t    DetailParamInfo,\r\n    \tDetailNavBar,\r\n      DetailSwiper,\r\n      DetailBaseInfo,\r\n\t    DetailShopInfo,\r\n      DetailGoodsInfo,\r\n      DetailCommentInfo,\r\n      CartButton,\r\n\t    GoodsList,\r\n      DetailBottomBar,\r\n      Scroll,\r\n      Toast\r\n    },\r\n    mixins: [backTopMixin],\r\n    data() {\r\n      return {\r\n      \tiid: '',\r\n        topImages: [],\r\n        goods: {},\r\n        shop: {},\r\n\t      detailInfo: {},\r\n        paramInfo: {},\r\n        commentInfo: {},\r\n        goodsList: [],\r\n        themeTops: [],\r\n        currentIndex: 0\r\n      }\r\n    },\r\n    created() {\r\n    \t// 1.取出iid\r\n      this.iid = this.$route.query.iid\r\n\r\n      // 2.发送商品请求\r\n      this._getDetail(this.iid)\r\n\r\n      // 3.请求推荐请求\r\n      this._getRecommend()\r\n    },\r\n    methods: {\r\n      ...mapActions({\r\n        addCart: 'addToCart'\r\n      }),\r\n\t    imageLoad() {\r\n\t    \tthis.$refs.scroll.refresh()\r\n        // 获取对应的offsetTop\r\n        this.themeTops = []\r\n        this.themeTops.push(0)\r\n        this.themeTops.push(this.$refs.param.$el.offsetTop)\r\n        this.themeTops.push(this.$refs.comment.$el.offsetTop)\r\n        this.themeTops.push(this.$refs.recommend.$el.offsetTop)\r\n        this.themeTops.push(Number.MAX_VALUE)\r\n\t    },\r\n\t    selectIndex(index) {\r\n\t\t    this.$refs.scroll.scrollTo(0, -this.themeTops[index], 500)\r\n\t    },\r\n\t    contentScroll(position) {\r\n\t    \t// 决定backTop按钮是否显示\r\n\t\t    this.showBackTop = position.y <= -1000\r\n\t    \t// 监听滚动到某个主题\r\n        this._listenScrollTheme(-position.y)\r\n\t    },\r\n      _listenScrollTheme(position) {\r\n\t      let length = this.themeTops.length;\r\n\t      for (let i = 0; i < length; i++) {\r\n\t\t      let iPos = this.themeTops[i];\r\n\t\t      /**\r\n\t\t       * 判断的方案:\r\n\t\t       *  方案一:\r\n\t\t       *    条件: (i < (length-1) && currentPos >= iPos && currentPos < this.themeTops[i+1]) || (i === (length-1) && currentPos >= iPos),\r\n\t\t       *    优点: 不需要引入其他的内容, 通过逻辑解决\r\n\t\t       *    缺点: 判断条件过长, 并且不容易理解\r\n\t\t       *  方案二:\r\n\t\t       *    条件: 给themeTops最后添加一个很大的值, 用于和最后一个主题的top进行比较.\r\n\t\t       *    优点: 简洁明了, 便于理解\r\n\t\t       *    缺点: 需要引入一个较大的int数字\r\n\t\t       * 疑惑: 在第一个判断中, 为什么不能直接判断(currentPos >= iPos)即可?\r\n\t\t       * 解答: 比如在某一个currentPos大于第0个时, 就会break, 不会判断后面的i了.\r\n\t\t       */\r\n\t\t      if (position >= iPos && position < this.themeTops[i+1]) {\r\n\t\t\t      if (this.currentIndex !== i) {\r\n\t\t\t\t      this.currentIndex = i;\r\n\t\t\t      }\r\n\t\t\t      break;\r\n\t\t      }\r\n\t      }\r\n      },\r\n\t    cartClick() {\r\n\t    \tthis.$router.push('/cart')\r\n      },\r\n\t    addToCart() {\r\n        // 2.将商品信息添加到Store中\r\n        const obj = {}\r\n        obj.iid = this.iid\r\n        obj.imgURL = this.topImages[0]\r\n        obj.title = this.goods.title\r\n        obj.desc = this.goods.desc\r\n        obj.price = this.goods.realPrice\r\n        // this.$store.dispatch('addToCart', obj).then(() => {\r\n\t       //  this.$toast({message: '加入购物车成功'})\r\n        // })\r\n        this.addCart(obj).then(() => {\r\n\t        this.$toast({message: '加入购物车成功'})\r\n        })\r\n\t    },\r\n    \t_getDetail(iid) {\r\n        getDetail(iid).then(res => {\r\n        \t// 1.获取数据\r\n          const data = res.result\r\n\t        console.log(data);\r\n\r\n\t        // 2.获取顶部的图片数据\r\n          this.topImages = data.itemInfo.topImages\r\n\r\n          // 3.获取商品信息\r\n          this.goods = new Goods(data.itemInfo, data.columns, data.shopInfo.services)\r\n\r\n          // 4.获取店铺信息\r\n          this.shop = new Shop(data.shopInfo)\r\n\r\n          // 5.获取商品详细信息\r\n          this.detailInfo = data.detailInfo\r\n\r\n          // 6.保存参数信息\r\n          this.paramInfo = new GoodsParam(data.itemParams.info, data.itemParams.rule)\r\n\r\n          // 7.保存评论数据\r\n\t        if (data.rate.list) {\r\n\t\t        this.commentInfo = data.rate.list[0];\r\n\t        }\r\n        })\r\n      },\r\n\t    _getRecommend() {\r\n\t    \tgetRecommend().then(res => {\r\n\t    \t\tthis.goodsList = res.data.list\r\n\t\t    })\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n  #detail {\r\n    height: 100vh;\r\n    position: relative;\r\n    z-index: 1;\r\n    background-color: #fff;\r\n  }\r\n\r\n  .content {\r\n    position: absolute;\r\n    top: 44px;\r\n    bottom: 58px;\r\n    left: 0;\r\n    right: 0;\r\n  }\r\n</style>"]}]}